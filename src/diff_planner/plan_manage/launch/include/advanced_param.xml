<launch>
    <arg name="local_map_size_x_"/>
    <arg name="local_map_size_y_"/>
    <arg name="local_map_size_z_"/>
    <arg name="odom_topic"/>
    <arg name="camera_pose_topic"/>
    <arg name="depth_topic"/>
    <arg name="cloud_topic"/>
    <arg name="cx"/>
    <arg name="cy"/>
    <arg name="fx"/>
    <arg name="fy"/>
    <arg name="max_vel"/>
    <arg name="max_acc"/>
    <arg name="planning_horizon"/>
    <arg name="virtual_ceil"/>
    <arg name="virtual_ground"/>
    <arg name="map_resolution"/>
    <arg name="inflation_size"/>
    <!-- main node -->
    <!-- <node pkg="diff_planner" name="diff_planner_node" type="diff_planner_node" output="screen" launch-prefix="valgrind"> -->
    <node pkg="diff_planner" name="diff_planner_node" type="diff_planner_node" output="screen">
        <remap from="~odom_world" to="$(arg odom_topic)"/>
        <remap from="~planning/trajectory" to = "/diff_planner_node/planning/trajectory"/>
        <remap from="~planning/data_display" to = "/diff_planner_node/planning/data_display"/>
        <remap from="~planning/broadcast_traj_send" to = "/broadcast_traj_from_planner"/>
        <remap from="~planning/broadcast_traj_recv" to = "/broadcast_traj_to_planner"/>
        <!-- <remap from="~planning/heartbeat" to = "/traj_server/heartbeat"/> -->
        <remap from="~planning/heartbeat" to = "/diff_planner_node/planning/heartbeat"/>
        <!-- <remap from="/goal" to = "/goal_with_id"/> -->
        <remap from="~grid_map/odom" to="$(arg odom_topic)"/>
        <remap from="~grid_map/cloud" to="$(arg cloud_topic)"/>
        <remap from="~grid_map/pose"   to = "$(arg camera_pose_topic)"/>
        <remap from="~grid_map/depth" to = "$(arg depth_topic)"/>
        <!-- planning fsm -->
        <param name="fsm/flight_type" value="1" type="int"/>
        <param name="fsm/thresh_replan_time" value="1.0" type="double"/>
        <param name="fsm/planning_horizon" value="$(arg planning_horizon)" type="double"/>
        <!--always set to 1.5 times grater than sensing horizen-->
        <param name="fsm/emergency_time" value="1.0" type="double"/>
        <param name="fsm/realworld_experiment" value="true"/>
        <param name="fsm/fail_safe" value="true"/>
        <param name="fsm/modify_final_goal" value="true"/>
        <param name="fsm/enable_stuck_detect" value="true"/>
        <param name="grid_map/resolution" value="$(arg map_resolution)" />
        <param name="grid_map/local_update_range_x" value="$(arg local_map_size_x_)" />
        <param name="grid_map/local_update_range_y" value="$(arg local_map_size_y_)" />
        <param name="grid_map/local_update_range_z" value="$(arg local_map_size_z_)" /> 
        <param name="grid_map/obstacles_inflation" value="$(arg inflation_size)" />
        <param name="grid_map/enable_virtual_wall" value="true"/>
        <param name="grid_map/virtual_ceil" value="$(arg virtual_ceil)"/>
        <param name="grid_map/virtual_ground" value="$(arg virtual_ground)"/>
        <param name="grid_map/ground_height" value="-0.01"/>
        <!-- camera parameter -->
        <param name="grid_map/cx" value="$(arg cx)"/>
        <param name="grid_map/cy" value="$(arg cy)"/>
        <param name="grid_map/fx" value="$(arg fx)"/>
        <param name="grid_map/fy" value="$(arg fy)"/>
        <!-- depth filter -->
        <param name="grid_map/use_depth_filter" value="true"/>
        <param name="grid_map/depth_filter_tolerance" value="0.15"/>
        <param name="grid_map/depth_filter_maxdist" value="5.0"/>
        <param name="grid_map/depth_filter_mindist" value="0.2"/>
        <param name="grid_map/depth_filter_margin" value="2"/>
        <param name="grid_map/k_depth_scaling_factor" value="1000.0"/>
        <param name="grid_map/skip_pixel" value="1"/>
        <!-- local fusion -->
        <param name="grid_map/p_hit" value="0.9"/>
        <param name="grid_map/p_miss" value="0.49"/>
        <param name="grid_map/p_min" value="0.12"/>
        <param name="grid_map/p_max" value="0.98"/>
        <param name="grid_map/p_occ" value="0.85"/>
        <param name="grid_map/fading_time" value="1.0"/>
        <param name="grid_map/min_ray_length" value="0.1"/>
        <param name="grid_map/max_ray_length" value="6.0"/>
        <param name="grid_map/visualization_truncate_height" value="3.0"/>
        <param name="grid_map/show_occ_time" value="false"/>
        <param name="grid_map/pose_type" value="2"/>
        <param name="grid_map/frame_id" value="world"/>
        <!-- planner manager -->
        <param name="manager/max_vel" value="$(arg max_vel)" type="double"/>
        <param name="manager/max_acc" value="$(arg max_acc)" type="double"/>
        <param name="manager/polyTraj_piece_length" value="1.5" type="double"/>
        <param name="manager/feasibility_tolerance" value="0.05" type="double"/>
        <param name="manager/planning_horizon" value="$(arg planning_horizon)" type="double"/>
        <param name="manager/use_multitopology_trajs" value="false" type="bool"/>
        <param name="manager/drone_id" value="0"/>
        <!-- trajectory optimization -->
        <param name="optimization/constraint_points_perPiece" value="5" type="int"/>
        <param name="optimization/weight_obstacle" value="10000.0" type="double"/>
        <param name="optimization/weight_obstacle_soft" value="5000.0" type="double"/>
        <param name="optimization/weight_swarm" value="10000.0" type="double"/>
        <param name="optimization/weight_feasibility" value="10000.0" type="double"/>
        <param name="optimization/weight_sqrvariance" value="10000.0" type="double"/>
        <param name="optimization/weight_time" value="10.0" type="double"/>
        <param name="optimization/obstacle_clearance" value="0.1" type="double"/>
        <param name="optimization/obstacle_clearance_soft" value="0.5" type="double"/>
        <param name="optimization/swarm_clearance" value="0.15000000000000002" type="double"/> <!-- heterogeneous support: my required clearance -->
        <param name="optimization/max_vel" value="$(arg max_vel)" type="double"/>
        <param name="optimization/vel_tolerance" value="1.0" type="double"/>
        <param name="optimization/max_acc" value="$(arg max_acc)" type="double"/>
        <param name="optimization/acc_tolerance" value="1.0" type="double"/>
        <param name="optimization/max_jer" value="20" type="double"/>
        <param name="optimization/record_opt" value="false"/>
    </node>
</launch>
